<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Viewçš„ç»˜åˆ¶è¿‡ç¨‹ Â· 70kg</title><meta name="description" content="Viewçš„ç»˜åˆ¶è¿‡ç¨‹ - 70kg"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="70kg"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/2790907881/profile?topnav=1&amp;wvr=6&amp;is_all=1" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/70kg" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Viewçš„ç»˜åˆ¶è¿‡ç¨‹</h1><div class="post-info">Jul 9, 2016</div><div class="post-content"><p>&emsp;&emsp;è¿™æ¬¡æ¥è¯´ä¸€è¯´viewçš„ç»˜åˆ¶è¿‡ç¨‹ï¼ŒåŒæ ·ä¹Ÿç®—æ˜¯ä¸ªç¬”è®°çš„ä¸œè¥¿ï¼Œæ¢³ç†ä¸€ä¸‹å¤§è‡´çš„è¿‡ç¨‹ï¼Œå¿½ç•¥äº†å†…éƒ¨å¾ˆå¤šçš„æ¡ä»¶åˆ¤æ–­ç­‰ã€‚ä¸Šæ¬¡è¯´äº†<code>setcontentview</code>å’Œ<code>infalter</code>çš„ä¸€äº›ç®€å•è¿‡ç¨‹ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æŠŠviewä»XMLæ–‡ä»¶çš„æ ¼å¼è§£æå’ŒåŠ è½½ï¼Œä½†æ˜¯å…·ä½“viewçš„æ€ä¹ˆç»˜åˆ¶åˆ°ç•Œé¢ä¸Šçš„å¹¶æ²¡æœ‰æåŠï¼Œè¿˜æœ‰ä¸Šæ¬¡ç•™ä¸‹çš„é—®é¢˜ï¼Œæœ‰æ—¶é—´å­¦ä¹ äº†<code>activity</code>çš„å¯åŠ¨æµç¨‹å†æ¥è¯´ä¸€ä¸‹ï¼Œç°åœ¨å¼€å§‹å§ã€‚<a id="more"></a></p>
<p>&emsp;&emsp;ç½‘ä¸Šæœ‰å¾ˆå¤šçš„æ–‡ç« è¯´viewçš„ç»˜åˆ¶ï¼Œæ— éå°±æ˜¯ä¸‰ä¸ªæ–¹æ³•<code>onMeasure</code>,<code>onLayout</code>,<code>onDraw</code>ï¼Œä½†æ˜¯è¿™ä»…ä»…æ˜¯å†°å±±ä¸€è§’ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨æ—¶æœºå’Œå†…éƒ¨çš„å¤§è‡´è¿è¡Œé€»è¾‘å¹¶æ²¡æœ‰è¯´æ¸…æ¥šï¼Œç°åœ¨å…ˆä»viewå¼€å§‹çš„åœ°æ–¹è¯´èµ·ã€‚</p>
<p>&emsp;&emsp;viewä»ä»€ä¹ˆåœ°æ–¹å¼€å§‹ç»˜åˆ¶å‘¢ï¼Œå…ˆè¯´ç»“è®ºå§ï¼Œå› ä¸ºæ²¡æœ‰ä¸€äº›é“ºå«å³ä½¿ä»å¼€å§‹çš„åœ°æ–¹è¯´èµ·ä¹Ÿæ˜¯äº‘é‡Œé›¾é‡Œï¼Œè¯´å®Œæ•´ä¸ªçš„å¤§è‡´è¿‡ç¨‹ï¼Œå†å»çœ‹å¼€å§‹çš„åœ°æ–¹ä¹Ÿå°±é¡ºå…¶è‡ªç„¶äº†ã€‚viewçš„ç»˜åˆ¶æ˜¯ä»<code>ViewRootImpl</code> çš„<code>performTraversals</code>æ–¹æ³•å¼€å§‹çš„ï¼Œç¿»è¯‘å°±æ˜¯é€’å½’è°ƒç”¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œviewæ˜¯åµŒå¥—å­˜åœ¨çš„ï¼Œæ‰€ä»¥è¦å»ç»˜åˆ¶æ•´ä¸ªçš„viewè‚¯å®šè¦å»åµŒå¥—è°ƒç”¨ä¸€äº›æ–¹æ³•ï¼Œ(ps:è¿™ä¸ªæºç æ˜¯åœ¨API22ä¸‹çœ‹çš„ï¼Œåœ¨23çš„æ—¶å€™åˆæœ‰ä¸€äº›æ”¹å˜ï¼Œä½†æ˜¯æ•´ä¸ªçš„é€»è¾‘æ˜¯æ²¡æœ‰å˜åŒ–çš„)ã€‚æˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™æ˜¯ä¸ªéå¸¸é•¿çš„æ–¹æ³•ï¼Œä¸€å…±æœ‰782è¡Œï¼Œæ‰€ä»¥ä¼šå»å¿½ç•¥å¾ˆå¤šçš„åˆ¤æ–­æ¡ä»¶ï¼Œåªæ‰€æˆ‘ä»¬å…³æ³¨çš„ä¸‰ä¸ªé‡ç‚¹æ–¹æ³•ï¼Œé¦–å…ˆæ‰¾åˆ°è¿™é‡Œï¼š</p>
<p>###Measure<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);</div><div class="line">int childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);</div><div class="line">// Ask host how big it wants to be</div><div class="line">performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå°±æ˜¯è¿›è¡Œviewæµ‹ç»˜çš„åœ°æ–¹ï¼Œå…ˆå»<code>getRootMeasureSpec</code>æ–¹æ³•é‡Œé¢çœ‹çœ‹ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">private static int getRootMeasureSpec(int windowSize, int rootDimension) &#123;</div><div class="line">        int measureSpec;</div><div class="line">        switch (rootDimension) &#123;</div><div class="line"></div><div class="line">        case ViewGroup.LayoutParams.MATCH_PARENT:</div><div class="line">            // Window can&apos;t resize. Force root view to be windowSize.</div><div class="line">            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);</div><div class="line">            break;</div><div class="line">        case ViewGroup.LayoutParams.WRAP_CONTENT:</div><div class="line">            // Window can resize. Set max size for root view.</div><div class="line">            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);</div><div class="line">            break;</div><div class="line">        default:</div><div class="line">            // Window wants to be an exact size. Force root view to be that size.</div><div class="line">            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">        return measureSpec;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ªç»„è£…å‚æ•°çš„åœ°æ–¹ï¼Œåƒæˆ‘ä»¬å¹³å¸¸è¯´çš„<code>MATCH_PARENT</code>å¯¹åº”<code>EXACTLY</code>ï¼Œ<code>WRAP_CONTENT</code>å¯¹åº”<code>AT_MOST</code>è¿™é‡Œå°±çœ‹çš„å¾ˆæ¸…æ¥šäº†ï¼Œè€Œä¸”è¿™ä¸ªæ ¹è§†å›¾ï¼Œä¹‹å‰æåˆ°è¿‡çš„ï¼Œè‚¯å®šæ˜¯èµ°<code>MATCH_PARENT</code>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ ¹è§†å›¾æ€»æ˜¯å…¨å±çš„åŸå› ã€‚</p>
<p>&emsp;&emsp;å›åˆ°å‰é¢è¿˜æœ‰ä¸ª<code>performMeasure</code>æ–¹æ³•ï¼Œçœ‹æ³¨é‡Šä¹ŸçŸ¥é“æ˜¯å¹²å•¥çš„ï¼Œè¿›å»çœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">private void performMeasure(int childWidthMeasureSpec, int childHeightMeasureSpec) &#123;</div><div class="line">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, &quot;measure&quot;);</div><div class="line">        try &#123;</div><div class="line">            mView.measure(childWidthMeasureSpec, childHeightMeasureSpec);</div><div class="line">        &#125; finally &#123;</div><div class="line">            Trace.traceEnd(Trace.TRACE_TAG_VIEW);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>çœ‹ï¼Œæ¥åˆ°äº†viewçš„<code>measure</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´<code>measure</code>æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°å…¶å®éƒ½æ˜¯çˆ¶viewçš„ï¼Œä¸‹é¢è¿˜å¯ä»¥çœ‹åˆ°ï¼ŒçœŸæ­£å†³å®šä¸€ä¸ªviewçš„å¤§å°æ˜¯è¿™çˆ¶viewçš„ä¸¤ä¸ªå‚æ•°å’Œå­viewå…±åŒå†³å®šçš„ã€‚ä¸‹é¢å°±è¿›åˆ°äº†viewé‡Œé¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">    * &lt;p&gt;</div><div class="line">    * This is called to find out how big a view should be. The parent</div><div class="line">    * supplies constraint information in the width and height parameters.</div><div class="line">    * &lt;/p&gt;</div><div class="line">    *</div><div class="line">    * &lt;p&gt;</div><div class="line">    * The actual measurement work of a view is performed in</div><div class="line">    * &#123;@link #onMeasure(int, int)&#125;, called by this method. Therefore, only</div><div class="line">    * &#123;@link #onMeasure(int, int)&#125; can and must be overridden by subclasses.</div><div class="line">    * &lt;/p&gt;</div><div class="line">    *</div><div class="line">    *</div><div class="line">    * @param widthMeasureSpec Horizontal space requirements as imposed by the</div><div class="line">    *        parent</div><div class="line">    * @param heightMeasureSpec Vertical space requirements as imposed by the</div><div class="line">    *        parent</div><div class="line">    *</div><div class="line">    * @see #onMeasure(int, int)</div><div class="line">    */</div><div class="line">   public final void measure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">   ...å„ç§ä¸æ˜ç™½çš„ä¸œè¥¿ã€‚ã€‚ğŸ˜‚</div><div class="line">   </div><div class="line">      onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">      </div><div class="line">    ...ç»§ç»­å„ç§ä¸æ˜ç™½çš„ä¸œè¥¿ã€‚ã€‚ğŸ˜‚</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦è¿˜æ˜¯çœ‹æ³¨é‡Šï¼Œå››çº§æ°´å¹³ç†è§£ä¸€ä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨ç”¨æ¥æµ‹é‡viewåº”è¯¥æœ‰å¤šå¤§ï¼Œçˆ¶å¸ƒå±€åœ¨å®½é«˜é‡Œé¢æä¾›é™åˆ¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„viewçš„å¤§å°ç”±çˆ¹å’Œå„¿å­ä¸€èµ·å†³å®šï¼Œè¿˜æœ‰å°±æ˜¯å®é™…çš„æµ‹é‡å·¥ä½œæ˜¯åœ¨å­ç±»çš„<code>onMeasure</code>æ–¹æ³•é‡Œé¢æï¼Œå› ä¸º<code>measure</code>æ˜¯finalçš„ã€‚è¿™å°±æ˜¯å¹³æ—¶è‡ªå®šä¹‰viewçš„æ—¶å€™è¦å»ä»å†™è¿™ä¸ªæ–¹æ³•çš„åŸå› ï¼Œåˆ«æ€¥ï¼Œè¿˜æ²¡å®Œï¼Œè¿›å»çœ‹çœ‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Measure the view and its content to determine the measured width and the</div><div class="line">     * measured height. This method is invoked by &#123;@link #measure(int, int)&#125; and</div><div class="line">     * should be overridden by subclasses to provide accurate and efficient</div><div class="line">     * measurement of their contents.</div><div class="line">     * &lt;/p&gt;</div><div class="line">     *</div><div class="line">     * &lt;p&gt;</div><div class="line">     * &lt;strong&gt;CONTRACT:&lt;/strong&gt; When overriding this method, you</div><div class="line">     * &lt;em&gt;must&lt;/em&gt; call &#123;@link #setMeasuredDimension(int, int)&#125; to store the</div><div class="line">     * measured width and height of this view. Failure to do so will trigger an</div><div class="line">     * &lt;code&gt;IllegalStateException&lt;/code&gt;, thrown by</div><div class="line">     * &#123;@link #measure(int, int)&#125;. Calling the superclass&apos;</div><div class="line">     * &#123;@link #onMeasure(int, int)&#125; is a valid use.</div><div class="line">     * &lt;/p&gt;</div><div class="line">     *</div><div class="line">     * &lt;p&gt;</div><div class="line">     * The base class implementation of measure defaults to the background size,</div><div class="line">     * unless a larger size is allowed by the MeasureSpec. Subclasses should</div><div class="line">     * override &#123;@link #onMeasure(int, int)&#125; to provide better measurements of</div><div class="line">     * their content.</div><div class="line">     * &lt;/p&gt;</div><div class="line">     *</div><div class="line">     * &lt;p&gt;</div><div class="line">     * If this method is overridden, it is the subclass&apos;s responsibility to make</div><div class="line">     * sure the measured height and width are at least the view&apos;s minimum height</div><div class="line">     * and width (&#123;@link #getSuggestedMinimumHeight()&#125; and</div><div class="line">     * &#123;@link #getSuggestedMinimumWidth()&#125;).</div><div class="line">     * &lt;/p&gt;</div><div class="line">     *</div><div class="line">     * @param widthMeasureSpec horizontal space requirements as imposed by the parent.</div><div class="line">     *                         The requirements are encoded with</div><div class="line">     *                         &#123;@link android.view.View.MeasureSpec&#125;.</div><div class="line">     * @param heightMeasureSpec vertical space requirements as imposed by the parent.</div><div class="line">     *                         The requirements are encoded with</div><div class="line">     *                         &#123;@link android.view.View.MeasureSpec&#125;.</div><div class="line">     *</div><div class="line">     * @see #getMeasuredWidth()</div><div class="line">     * @see #getMeasuredHeight()</div><div class="line">     * @see #setMeasuredDimension(int, int)</div><div class="line">     * @see #getSuggestedMinimumHeight()</div><div class="line">     * @see #getSuggestedMinimumWidth()</div><div class="line">     * @see android.view.View.MeasureSpec#getMode(int)</div><div class="line">     * @see android.view.View.MeasureSpec#getSize(int)</div><div class="line">     */</div><div class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</div><div class="line">                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥å»è¯»ä¸€è¯»æ³¨é‡Šï¼Œç®€å•è¯´ä¸€ä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æµ‹é‡viewå’Œå®ƒçš„å†…å®¹ï¼Œè€Œä¸”ä¸€å®šè¦è°ƒç”¨<code>setMeasuredDimension</code>æŠŠæµ‹é‡çš„ç»“æœç©¿è¿›å»ï¼ŒåŸºç±»é»˜è®¤å®ç°çš„èƒŒæ™¯çš„å¤§å°(è¿™ä¸ªåœ¨ä¸‹é¢çœ‹åˆ°)ã€‚å¦‚æœé‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½ å¾—ææ¸…æ¥šè¿™ä¸ªviewçš„å¤§å°è‡³å°‘æ¯”æœ€å°çš„å¤§ï¼ˆåé¢ä¼šè¯´ï¼‰ã€‚å¥½å§ï¼Œè¹©è„šçš„è‹±æ–‡ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æµ‹é‡å®Œviewä¹‹åï¼Œå†<code>setMeasuredDimension</code>ï¼Œæˆ‘ä»¬çš„å·¥ä½œå°±ç»“æŸäº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œå»çœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public static int getDefaultSize(int size, int measureSpec) &#123;</div><div class="line">        int result = size;</div><div class="line">        int specMode = MeasureSpec.getMode(measureSpec);</div><div class="line">        int specSize = MeasureSpec.getSize(measureSpec);</div><div class="line"></div><div class="line">        switch (specMode) &#123;</div><div class="line">        case MeasureSpec.UNSPECIFIED:</div><div class="line">            result = size;</div><div class="line">            break;</div><div class="line">        case MeasureSpec.AT_MOST:</div><div class="line">        case MeasureSpec.EXACTLY:</div><div class="line">            result = specSize;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">        return result;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤çš„æ—¶å€™ï¼Œå½“è®¾ç½®<code>wrap_content</code>å’Œ<code>march_parent</code>éƒ½æ˜¯é»˜è®¤çš„çˆ¶å¸ƒå±€çš„å¤§å°ï¼Œè¿™é‡Œçš„sizeæ˜¯è¿›ä¸€æ­¥<code>getSuggestedMinimumWidth</code>ä¼ è¿›æ¥çš„,è€Œè¿™ä¸ªçš„å¤§å°æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">protected int getSuggestedMinimumWidth() &#123;</div><div class="line">       return (mBackground == null) ? mMinWidth : max(mMinWidth, mBackground.getMinimumWidth());</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>çœ‹æœ‰æ²¡æœ‰èƒŒæ™¯ï¼Œè¿™ä¸ªé»˜è®¤æ˜¯0ï¼Œä¹Ÿå¯ä»¥åœ¨XMLä¸­è®¾ç½®,è¿™æ ·ä¹Ÿè¯´å®Œäº†å‰é¢çš„ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<p>&emsp;&emsp;åˆ°è¿™é‡Œï¼Œä¼¼ä¹viewçš„æµ‹é‡å°±å®Œäº†ï¼Œä½†æ˜¯ä¸è¦å¿˜è®°ï¼Œviewæ˜¯åµŒå¥—çš„ï¼Œè¦å»æµ‹é‡å®Œæ•´ä¸ªçš„viewï¼Œè¿˜å¾—å»<code>viewgroup</code>é‡Œé¢çœ‹çœ‹ï¼Œ<code>viewgroup</code>é‡Œé¢æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š<code>measureChildren</code>, <code>measureChild</code>, <code>measureChildWithMargins</code>ï¼Œä¸€ä¸ªä¸ªçœ‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Ask all of the children of this view to measure themselves, taking into</div><div class="line">     * account both the MeasureSpec requirements for this view and its padding.</div><div class="line">     * We skip children that are in the GONE state The heavy lifting is done in</div><div class="line">     * getChildMeasureSpec.</div><div class="line">     *</div><div class="line">     * @param widthMeasureSpec The width requirements for this view</div><div class="line">     * @param heightMeasureSpec The height requirements for this view</div><div class="line">     */</div><div class="line">    protected void measureChildren(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">        final int size = mChildrenCount;</div><div class="line">        final View[] children = mChildren;</div><div class="line">        for (int i = 0; i &lt; size; ++i) &#123;</div><div class="line">            final View child = children[i];</div><div class="line">            if ((child.mViewFlags &amp; VISIBILITY_MASK) != GONE) &#123;</div><div class="line">                measureChild(child, widthMeasureSpec, heightMeasureSpec);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>éå†æ‰€ä»¥çš„å­viewï¼Œå»æµ‹é‡ï¼Œå¦‚æœæ˜¯goneçš„ï¼Œå°±è·³è¿‡ã€‚ç„¶åè¿›å…¥<code>measureChild</code>ï¼Œæé†’ä¸€ä¸‹ï¼Œè¿™é‡Œä¼ è¿›å»çš„<code>widthMeasureSpec</code>å’Œ<code>heightMeasureSpec</code>éƒ½æ˜¯çˆ¶viewçš„ï¼Œç”¨æ¥åœ¨å­viewæµ‹é‡çš„æ—¶å€™å…±åŒå†³å®šå¤§å°ç”¨çš„ã€‚è¿™é‡Œçš„<code>measureChild</code>åªåŒ…å«<code>Padding</code>ï¼Œ<code>measureChildWithMargins</code>è¿˜åŒ…å«<code>Margin</code>ï¼Œè°ƒå¤æ‚çš„çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">protected void measureChildWithMargins(View child,</div><div class="line">            int parentWidthMeasureSpec, int widthUsed,</div><div class="line">            int parentHeightMeasureSpec, int heightUsed) &#123;</div><div class="line">            //è·å–å­çš„LayoutParams</div><div class="line">        final MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();</div><div class="line">//çœ‹ï¼Œå­viewçš„å¤§å°æ˜¯ç”±è°å†³å®šçš„ï¼Œæ²¡é”™å§ï¼Œè¿™é‡Œç«Ÿç„¶è¿˜ç›´æ¥è·å–åˆ°äº†lp.widthï¼Œè¿™ä¸ªçœ‹ä¸‹é¢è§£é‡Šå§ã€‚æç¤ºä¸€ä¸‹ï¼šè¿™ä¸ªå‚æ•°æ˜¯ï¼šHow big the child wants to be in the current dimension</div><div class="line">        final int childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,</div><div class="line">                mPaddingLeft + mPaddingRight + lp.leftMargin + lp.rightMargin</div><div class="line">                        + widthUsed, lp.width);</div><div class="line">        final int childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,</div><div class="line">                mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin</div><div class="line">                        + heightUsed, lp.height);</div><div class="line">       //è°ƒç”¨viewçš„measureè¿›è€Œè°ƒç”¨onmeasure</div><div class="line">        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>çœ‹æ³¨é‡Šï¼Œç„¶åçœ‹é‡è¦çš„<code>getChildMeasureSpec</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public static int getChildMeasureSpec(int spec, int padding, int childDimension) &#123;</div><div class="line">        int specMode = MeasureSpec.getMode(spec);</div><div class="line">        int specSize = MeasureSpec.getSize(spec);</div><div class="line"></div><div class="line">        int size = Math.max(0, specSize - padding);</div><div class="line"></div><div class="line">        int resultSize = 0;</div><div class="line">        int resultMode = 0;</div><div class="line">        //çˆ¶viewçš„æ¨¡å¼</div><div class="line">        switch (specMode) &#123;</div><div class="line">        // Parent has imposed an exact size on us</div><div class="line">        //çˆ¶viewæ˜¯å…·ä½“æ•°å€¼æˆ–è€…march_parent</div><div class="line">        case MeasureSpec.EXACTLY:</div><div class="line">            if (childDimension &gt;= 0) &#123;//å­viewä¸ºå…·ä½“æ•°å€¼</div><div class="line">               //ç›´æ¥èµ‹å€¼å…·ä½“æ•°å€¼</div><div class="line">                resultSize = childDimension;</div><div class="line">                //è¿”å›å­viewçš„æ¨¡å¼è®¾ç½®ä¸ºEXACTLY</div><div class="line">                resultMode = MeasureSpec.EXACTLY;</div><div class="line">            &#125; else if (childDimension == LayoutParams.MATCH_PARENT) &#123;//å­viewæ˜¯MATCH_PARENTï¼Œæ•°å€¼ä¸º-1</div><div class="line">                // Child wants to be our size. So be it.</div><div class="line">                //ç›´æ¥èµ‹å€¼çˆ¶viewçš„å¤§å°</div><div class="line">                resultSize = size;</div><div class="line">                 //è¿”å›å­viewçš„æ¨¡å¼è®¾ç½®ä¸ºEXACTLY</div><div class="line">                resultMode = MeasureSpec.EXACTLY;</div><div class="line">            &#125; else if (childDimension == LayoutParams.WRAP_CONTENT) &#123;//å­viewæ˜¯WRAP_CONTENTï¼Œæ•°å€¼ä¸º-2</div><div class="line">                // Child wants to determine its own size. It can&apos;t be</div><div class="line">                // bigger than us.</div><div class="line">                //è®¾ç½®å­viewçš„æœ€å¤§å€¼ä¸èƒ½è¶…è¿‡çˆ¶view</div><div class="line">                //è¿™ä¸ªä¸€èˆ¬è¿˜ä¼šåœ¨å­viewçš„onmeasureé‡Œé¢å»é‡å†™ï¼Œæ˜¯å§</div><div class="line">                resultSize = size;</div><div class="line">                //è¿”å›å­viewçš„æ¨¡å¼è®¾ç½®ä¸ºAT_MOST</div><div class="line">                resultMode = MeasureSpec.AT_MOST;</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line"></div><div class="line">     //ã€‚ã€‚ã€‚ã€‚</div><div class="line">     //è¿‡ç¨‹å·®ä¸å¤šçš„ä¸¤ä¸ªæ¨¡å¼AT_MOSTå’ŒUNSPECIFIED</div><div class="line">       </div><div class="line">        &#125;</div><div class="line">        return MeasureSpec.makeMeasureSpec(resultSize, resultMode);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>æ³¨é‡Šå·²ç»å¾ˆè¯¦ç»†äº†ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è§åˆ°çš„çˆ¶viewå’Œå­viewçš„åœ¨æŸäº›å…³ç³»ä¸‹é¢çš„å¸ƒå±€æ ·å¼ã€‚è¿™æ¬¡æ˜ç™½äº†å§ã€‚æ•´ä¸ªé€»è¾‘å¤§æ¦‚è¯´ä¸€ä¸‹ï¼Œrootviewè·å¾—å®½é«˜å’Œæ¨¡å¼ï¼Œé€šè¿‡<code>MeasureSpec</code>ä¼ ç»™ä¸‹ä¸€çº§ï¼Œä¸€èˆ¬æ˜¯<code>viewgroup</code>ï¼Œç„¶å<code>viewgroup</code>ä¸»è¦è°ƒç”¨<code>getChildMeasureSpec</code>æ ¹æ®ä¸Šé¢çš„<code>MeasureSpec</code>å­viewçš„<code>childDimension</code>æ¥ç¡®å®šè‡ªå·±<code>viewgroup</code>çš„å¤§å°ï¼Œå¦‚æœè¿˜æœ‰å­viewï¼ŒæŠŠè®¡ç®—å‡ºæ¥çš„è‡ªå·±çš„<code>MeasureSpec</code>å†ä¼ ä¸‹å».åœ¨viewgroupä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°è°ƒç”¨<code>setMeasuredDimension</code>æ–¹æ³•å»æŠŠæµ‹é‡çš„å€¼ä¼ é€’è¿›å»ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºviewgroupæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå…·ä½“çš„æµ‹é‡æ–¹å¼éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ï¼Œæ¯”å¦‚å¯ä»¥å»çœ‹çœ‹<code>LinearLayout</code>çš„å®ç°ï¼Œå°±åœ¨æµ‹é‡å®Œæˆåè°ƒç”¨äº†<code>setMeasuredDimension</code>æ–¹æ³•ã€‚æ‰€ä»¥åœ¨ä¸€èˆ¬è‡ªå®šä¹‰viewgroupçš„æ—¶å€™ï¼Œå¯ä»¥å…ˆå»è°ƒç”¨<code>measureChildren</code>å»æµ‹é‡å®Œå…¨éƒ¨çš„å­viewï¼Œè¿™æ ·å°±å¯ä»¥å»è·å–å­viewçš„å®½é«˜ï¼Œç„¶åå†å¹²ä»€ä¹ˆå°±éšä½ äº†ï¼Œæœ€åä¸è¦å¿˜è®°å»è°ƒç”¨<code>setMeasuredDimension</code>æ–¹æ³•ã€‚</p>
<p>###layout<br>&emsp;&emsp;ç°åœ¨æ•´ä¸ªviewçš„æµ‹ç»˜å°±å·®ä¸å¤šç»“æŸäº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¼€å§‹layoutçš„æ­¥éª¤ã€‚å…ˆå»çœ‹viewgroupé‡Œé¢çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">   public final void layout(int l, int t, int r, int b) &#123;</div><div class="line">       if (!mSuppressLayout &amp;&amp; (mTransition == null || !mTransition.isChangingLayout())) &#123;</div><div class="line">           if (mTransition != null) &#123;</div><div class="line">               mTransition.layoutChange(this);</div><div class="line">           &#125;</div><div class="line">           super.layout(l, t, r, b);</div><div class="line">       &#125; else &#123;</div><div class="line">           // record the fact that we noop&apos;d it; request layout when transition finishes</div><div class="line">           mLayoutCalledWhileSuppressed = true;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>å…¶å®è¿˜æ˜¯è°ƒç”¨äº†viewé‡Œé¢çš„<code>layout</code>æ–¹æ³•ï¼Œè¿›å»çœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public void layout(int l, int t, int r, int b) &#123;</div><div class="line">        ......</div><div class="line">        if (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) &#123;</div><div class="line">            //å›è°ƒonLayout</div><div class="line">            onLayout(changed, l, t, r, b);</div><div class="line">            ......</div><div class="line">        &#125;</div><div class="line">        ......</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å’Œ<code>measure</code>çš„è¿‡ç¨‹å·®ä¸å¤šï¼Œè¿˜æ˜¯å»è°ƒç”¨<code>onLayout</code>æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ç©ºçš„ï¼Œé‚£viewgroupçš„å‘¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected abstract void onLayout(boolean changed,</div><div class="line">            int l, int t, int r, int b);</div></pre></td></tr></table></figure>
<p>ä¹Ÿæ˜¯ç©ºçš„ï¼Œè¿˜å˜æˆæŠ½è±¡çš„äº†ï¼Œé‚£æ€»ç»“ä¸€ä¸‹ï¼šviewçš„layuoutæ–¹æ³•å¹¶æ²¡æœ‰åƒ<code>measure</code>æ–¹æ³•ä¸€ä¸‹æ˜¯finalçš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸æ¨èå»é‡å†™çš„ï¼Œå¦‚æœæœ‰éœ€è¦è¿˜æ˜¯å»é‡å†™<code>onLayout</code>æ–¹æ³•ï¼Œè€Œåœ¨viewgroupä¸­ï¼Œ<code>layout</code>å˜æˆäº†final,<code>onLayout</code>æ–¹æ³•å˜æˆæŠ½è±¡çš„äº†ï¼Œè¿™å°±è¦æ±‚å­ç±»å¿…é¡»å»å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¦å»å­ç±»è‡ªå·±å»å†³å®šé‡Œé¢çš„viewæ€ä¹ˆå»æ’å¸ƒï¼Œæ‰€ä»¥å»æ‰¾ä¸ªå­ç±»çœ‹çœ‹ï¼Œè¿˜æ˜¯æ‹¿<code>LinearLayout</code>çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected void onLayout(boolean changed, int l, int t, int r, int b) &#123;</div><div class="line">        if (mOrientation == VERTICAL) &#123;</div><div class="line">            layoutVertical(l, t, r, b);</div><div class="line">        &#125; else &#123;</div><div class="line">            layoutHorizontal(l, t, r, b);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>çœ‹åå­—å°±çŸ¥é“äº†ï¼Œä¸è§£é‡Šï¼Œé€‰ä¸ª<code>layoutVertical</code>çœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line">void layoutVertical(int left, int top, int right, int bottom) &#123;</div><div class="line">        final int paddingLeft = mPaddingLeft;</div><div class="line"></div><div class="line">        int childTop;</div><div class="line">        int childLeft;</div><div class="line">        //ç†è§£ä¸ºçˆ¶viewæä¾›ç»™å­viewçš„å®½åº¦</div><div class="line">        // Where right end of child should go</div><div class="line">        final int width = right - left;</div><div class="line">        //å­viewåœ¨çˆ¶viewä¸­çš„å³è¾¹ä½ç½®</div><div class="line">        int childRight = width - mPaddingRight;</div><div class="line">        </div><div class="line">        //å­viewçš„å¯ç”¨å¤§å°</div><div class="line">        // Space available for child</div><div class="line">        int childSpace = width - paddingLeft - mPaddingRight;</div><div class="line">        //å­viewçš„æ•°é‡</div><div class="line">        final int count = getVirtualChildCount();</div><div class="line">        //ä¸»è¦çš„Gravityæ–¹å¼</div><div class="line">        final int majorGravity = mGravity &amp; Gravity.VERTICAL_GRAVITY_MASK;</div><div class="line">        final int minorGravity = mGravity &amp; Gravity.RELATIVE_HORIZONTAL_GRAVITY_MASK;</div><div class="line"></div><div class="line">        switch (majorGravity) &#123;</div><div class="line">           case Gravity.BOTTOM://å±…åº•</div><div class="line">               // mTotalLength contains the padding already</div><div class="line">               childTop = mPaddingTop + bottom - top - mTotalLength;</div><div class="line">               break;</div><div class="line"></div><div class="line">               // mTotalLength contains the padding already</div><div class="line">           case Gravity.CENTER_VERTICAL:</div><div class="line">               childTop = mPaddingTop + (bottom - top - mTotalLength) / 2;</div><div class="line">               break;</div><div class="line"></div><div class="line">           case Gravity.TOP:</div><div class="line">           default:</div><div class="line">               childTop = mPaddingTop;</div><div class="line">               break;</div><div class="line">        &#125;</div><div class="line">//å¼€å§‹éå†äº†</div><div class="line">        for (int i = 0; i &lt; count; i++) &#123;</div><div class="line">            final View child = getVirtualChildAt(i);</div><div class="line">            if (child == null) &#123;</div><div class="line">                childTop += measureNullChild(i);</div><div class="line">                //å¿½ç•¥goneçš„</div><div class="line">            &#125; else if (child.getVisibility() != GONE) &#123;</div><div class="line">                final int childWidth = child.getMeasuredWidth();</div><div class="line">                final int childHeight = child.getMeasuredHeight();</div><div class="line">                </div><div class="line">                final LinearLayout.LayoutParams lp =</div><div class="line">                        (LinearLayout.LayoutParams) child.getLayoutParams();</div><div class="line">                </div><div class="line">                int gravity = lp.gravity;</div><div class="line">                if (gravity &lt; 0) &#123;</div><div class="line">                    gravity = minorGravity;</div><div class="line">                &#125;</div><div class="line">                final int layoutDirection = getLayoutDirection();</div><div class="line">                final int absoluteGravity = Gravity.getAbsoluteGravity(gravity, layoutDirection);</div><div class="line">                switch (absoluteGravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) &#123;</div><div class="line">                    case Gravity.CENTER_HORIZONTAL:</div><div class="line">                        childLeft = paddingLeft + ((childSpace - childWidth) / 2)</div><div class="line">                                + lp.leftMargin - lp.rightMargin;</div><div class="line">                        break;</div><div class="line"></div><div class="line">                    case Gravity.RIGHT:</div><div class="line">                        childLeft = childRight - childWidth - lp.rightMargin;</div><div class="line">                        break;</div><div class="line"></div><div class="line">                    case Gravity.LEFT:</div><div class="line">                    default:</div><div class="line">                        childLeft = paddingLeft + lp.leftMargin;</div><div class="line">                        break;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                if (hasDividerBeforeChildAt(i)) &#123;</div><div class="line">                    childTop += mDividerHeight;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                childTop += lp.topMargin;</div><div class="line">                //å…¶å®è¿˜æ˜¯è°ƒç”¨view.layout</div><div class="line">                setChildFrame(child, childLeft, childTop + getLocationOffset(child),</div><div class="line">                        childWidth, childHeight);</div><div class="line">                childTop += childHeight + lp.bottomMargin + getNextLocationOffset(child);</div><div class="line"></div><div class="line">                i += getChildrenSkipCount(child, i);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>æ•´ä¸ªçš„layoutè¿‡ç¨‹æ¯”measureå¥½ç†è§£ï¼Œè¿˜è¦æä¸€ä¸‹ï¼Œå¹³æ—¶ä½¿ç”¨çš„æ—¶å€™ä¼šé‡åˆ°<code>getMeasuredWidth</code>å’Œ<code>getWidth</code>ï¼Œè¿™é‡Œå°±å·®ä¸å¤šå¯ä»¥ç†è§£äº†ï¼Œç¬¬ä¸€ä¸ªæ˜¯åœ¨measureä¹‹åå¯ä»¥è·å–åˆ°ï¼Œè€Œç¬¬äºŒä¸ªéœ€è¦åœ¨layoutä¹‹åæ‰å¯ä»¥è·å–åˆ°ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ€»ç»“ä¸€ä¸‹ï¼š<br>measureæ“ä½œå®Œæˆåå¾—åˆ°çš„æ˜¯å¯¹æ¯ä¸ªViewç»æµ‹é‡è¿‡çš„measuredWidthå’Œ<code>measuredHeight</code>ï¼Œlayoutæ“ä½œå®Œæˆä¹‹åå¾—åˆ°çš„æ˜¯å¯¹æ¯ä¸ªViewè¿›è¡Œä½ç½®åˆ†é…åçš„mLeftã€mTopã€mRightã€mBottomï¼Œè¿™äº›å€¼éƒ½æ˜¯ç›¸å¯¹äºçˆ¶Viewæ¥è¯´çš„ã€‚å‡¡æ˜¯<code>layout_XXX</code>çš„å¸ƒå±€å±æ€§åŸºæœ¬éƒ½é’ˆå¯¹çš„æ˜¯åŒ…å«å­Viewçš„ViewGroupçš„ï¼Œå½“å¯¹ä¸€ä¸ªæ²¡æœ‰çˆ¶å®¹å™¨çš„Viewè®¾ç½®ç›¸å…³<code>layout_XXX</code>å±æ€§æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œçœ‹å‰é¢çš„é‚£ç¯‡ã€‚åˆ°è¿™é‡Œï¼Œlayoutçš„è¿‡ç¨‹ä¹Ÿå·®ä¸å¤šäº†ï¼Œè¯¥åˆ°äº†ç»˜åˆ¶çš„æ—¶å€™äº†ã€‚</p>
<p>###draw<br>viewçš„ç»˜åˆ¶è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œè´´ä¸€å¼ å›¾ï¼Œæ¥è‡ª<a href="http://blog.csdn.net/yanbober/article/details/46128379" target="_blank" rel="external">å·¥åŒ è‹¥æ°´</a><br><img src="http://img.blog.csdn.net/20150530154328068" alt=""><br>å› ä¸ºviewgroupæ²¡æœ‰å»é‡å†™drawæ–¹æ³•ï¼Œç›´æ¥å»çœ‹viewé‡Œé¢çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public void draw(Canvas canvas) &#123;</div><div class="line">       ...</div><div class="line"></div><div class="line">       /*</div><div class="line">        * Draw traversal performs several drawing steps which must be executed</div><div class="line">        * in the appropriate order:</div><div class="line">        *</div><div class="line">        *      1. Draw the background</div><div class="line">        *      2. If necessary, save the canvas&apos; layers to prepare for fading</div><div class="line">        *      3. Draw view&apos;s content</div><div class="line">        *      4. Draw children</div><div class="line">        *      5. If necessary, draw the fading edges and restore layers</div><div class="line">        *      6. Draw decorations (scrollbars for instance)</div><div class="line">        */</div><div class="line">      ...</div></pre></td></tr></table></figure>
<p>æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œä¸€å…±åˆ†ä¸º6æ­¥ï¼Œå…¶ä¸­2ï¼Œ5å¯ä»¥çœç•¥ï¼Œä¸€æ­¥æ­¥æ¥å§</p>
<p>####ç¬¬ä¸€æ­¥ï¼Œå¯¹Viewçš„èƒŒæ™¯è¿›è¡Œç»˜åˆ¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">private void drawBackground(Canvas canvas) &#123;</div><div class="line">//å¹³æ—¶è®¾ç½®çš„setbackground,å®è´¨éƒ½è½¬å˜ä¸ºä¸€ä¸ªDrawable</div><div class="line">        final Drawable background = mBackground;</div><div class="line">        ...</div><div class="line">        //è®¾ç½®ç»˜åˆ¶èŒƒå›´</div><div class="line">        setBackgroundBounds();</div><div class="line">        ...</div><div class="line">        final int scrollX = mScrollX;</div><div class="line">        final int scrollY = mScrollY;</div><div class="line">        if ((scrollX | scrollY) == 0) &#123;//æ²¡æœ‰æ»šåŠ¨</div><div class="line">            background.draw(canvas);</div><div class="line">        &#125; else &#123;</div><div class="line">            canvas.translate(scrollX, scrollY);</div><div class="line">            //æœ€ç»ˆä½¿ç”¨äº†Drawableçš„draw</div><div class="line">            background.draw(canvas);</div><div class="line">            canvas.translate(-scrollX, -scrollY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>####ç¬¬äºŒæ­¥ï¼Œä¿å­˜å›¾å±‚ï¼Œæ‰§è¡Œæ¸å˜æ“ä½œ<br>ä¸»è¦è°ƒç”¨<code>canvas.saveLayer</code>æ–¹æ³•ï¼Œä¸å¤šè¯´</p>
<p>####ç¬¬ä¸‰æ­¥ï¼Œç»˜åˆ¶å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// Step 3, draw the content</div><div class="line">       if (!dirtyOpaque) </div><div class="line">       onDraw(canvas);</div></pre></td></tr></table></figure>
<p>è€Œ<code>onDraw</code>åˆæ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œå› ä¸ºå…·ä½“ç»˜åˆ¶ä»€ä¹ˆä¸œè¥¿è¿˜å¾—å…·ä½“çš„viewè¯´äº†ç®—</p>
<p>####ç¬¬å››æ­¥ï¼Œç»˜åˆ¶æ‰€æœ‰çš„å­view</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> // Step 4, draw the children</div><div class="line">        dispatchDraw(canvas);</div><div class="line">        </div><div class="line">/**</div><div class="line">     * Called by draw to draw the child views. This may be overridden</div><div class="line">     * by derived classes to gain control just before its children are drawn</div><div class="line">     * (but after its own view has been drawn).</div><div class="line">     * @param canvas the canvas on which to draw the view</div><div class="line">     */</div><div class="line">    protected void dispatchDraw(Canvas canvas) &#123;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçœ‹åˆ°<code>dispatchDraw</code>æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œæ³¨é‡Šé‡Œé¢è¯´ï¼Œå¦‚æœåŒ…å«å­viewå°±éœ€è¦å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œå»viewgroupé‡Œé¢çœ‹çœ‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">   protected void dispatchDraw(Canvas canvas) &#123;</div><div class="line">       ......</div><div class="line">       final int childrenCount = mChildrenCount;</div><div class="line">       final View[] children = mChildren;</div><div class="line">       ......</div><div class="line">       for (int i = 0; i &lt; childrenCount; i++) &#123;</div><div class="line">           ......</div><div class="line">           if ((child.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE || child.getAnimation() != null) &#123;</div><div class="line">               more |= drawChild(canvas, child, drawingTime);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       ......</div><div class="line">       // Draw any disappearing views that have animations</div><div class="line">       if (mDisappearingChildren != null) &#123;</div><div class="line">           ......</div><div class="line">           for (int i = disappearingCount; i &gt;= 0; i--) &#123;</div><div class="line">               ......</div><div class="line">               more |= drawChild(canvas, child, drawingTime);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       ......</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>è¿˜æ˜¯å»éå†æ‰€æœ‰çš„å­view,ç„¶åå»è°ƒç”¨view.drawæ–¹æ³•</p>
<p>####ç¬¬äº”æ­¥ï¼Œç»˜åˆ¶æ¸å˜æ•ˆæœå¹¶ä¸”æ¢å¤å›¾å±‚<br>è¿™ä¸ªå’Œç¬¬äºŒéƒ¨ç›¸å¯¹åº”ï¼Œä¸è¯´äº†</p>
<p>###ç¬¬å…­æ­¥ï¼Œç»˜åˆ¶viewçš„æ»šåŠ¨æ¡<br>ä¹Ÿä¸åˆ†æäº†ï¼Œæ‰€ä»¥å…¶å®æ‰€æœ‰çš„ viewéƒ½æ˜¯æœ‰æ»šåŠ¨æ¡çš„</p>
<p>åˆ°è¿™é‡Œï¼Œæ•´ä¸ªviewå°±å·®ä¸å¤šç»˜åˆ¶å®Œæˆäº†ã€‚</p>
<p>###Viewçš„invalidate<br>å¦‚æœå»æŸ¥ä¸€æŸ¥viewçš„æºç ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ–¹æ³•å‡ºç°çš„ç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨å»é‡ç»˜viewçš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¹ˆå¤šæ¬¡ï¼Œè€Œä¸”å®ƒæ˜¯æ€ä¹ˆå»å®ç°é‡ç»˜çš„å‘¢ï¼Œè€Œä¸”å¼€å¤´çš„æ—¶å€™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œç®€å•çš„çœ‹ä¸€ä¸‹ã€‚<br>viewæœ‰å¤šä¸ªé‡è½½çš„<code>invalidate</code>ï¼Œä½†æ˜¯æœ€ç»ˆéƒ½èµ°åˆ°äº†<code>invalidateInternal</code>æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">void invalidateInternal(int l, int t, int r, int b, boolean invalidateCache,</div><div class="line">            boolean fullInvalidate) &#123;</div><div class="line">        ......</div><div class="line">            final AttachInfo ai = mAttachInfo;</div><div class="line">            final ViewParent p = mParent;</div><div class="line">            if (p != null &amp;&amp; ai != null &amp;&amp; l &lt; r &amp;&amp; t &lt; b) &#123;</div><div class="line">                final Rect damage = ai.mTmpInvalRect;</div><div class="line">                //è®¾ç½®åˆ·æ–°åŒºåŸŸ</div><div class="line">                damage.set(l, t, r, b);</div><div class="line">                //ä¼ é€’è°ƒè¿ViewParentï¼Œ ä¸€èˆ¬æ˜¯ViewGroupçš„invalidateChildæ–¹æ³•</div><div class="line">                p.invalidateChild(this, damage);</div><div class="line">            &#125;</div><div class="line">            ......</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦æ˜¯<code>p.invalidateChild(this, damage);</code>è¿™ä¸ªæ–¹æ³•ï¼Œ</p>
<blockquote>
<p>Viewçš„invalidateï¼ˆinvalidateInternalï¼‰æ–¹æ³•å®è´¨æ˜¯å°†è¦åˆ·æ–°åŒºåŸŸç›´æ¥ä¼ é€’ç»™äº†çˆ¶ViewGroupçš„invalidateChildæ–¹æ³•ï¼Œåœ¨invalidateä¸­ï¼Œè°ƒç”¨çˆ¶Viewçš„invalidateChildï¼Œè¿™æ˜¯ä¸€ä¸ªä»å½“å‰å‘ä¸Šçº§çˆ¶Viewå›æº¯çš„è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚çš„çˆ¶Viewéƒ½å°†è‡ªå·±çš„æ˜¾ç¤ºåŒºåŸŸä¸ä¼ å…¥çš„åˆ·æ–°Rectåšäº¤é›† ã€‚</p>
</blockquote>
<p>è€Œ<code>ViewParent</code>æ˜¯ä¸ªæ¥å£ï¼Œviewgroupå’Œ<code>ViewRootImpl</code>éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œæ‰€ä»¥å…ˆå»viewgroupçœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public final void invalidateChild(View child, final Rect dirty) &#123;</div><div class="line">       ViewParent parent = this;</div><div class="line">       final AttachInfo attachInfo = mAttachInfo;</div><div class="line">       ......</div><div class="line">       do &#123;</div><div class="line">           ......</div><div class="line">           //å¾ªç¯å±‚å±‚ä¸Šçº§è°ƒè¿ï¼Œç›´åˆ°ViewRootImplä¼šè¿”å›null</div><div class="line">           parent = parent.invalidateChildInParent(location, dirty);</div><div class="line">           ......</div><div class="line">       &#125; while (parent != null);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿›è¡Œäº†äº†å¾ªç¯ï¼Œæœ€ç»ˆè¿˜æ˜¯å»äº†<code>ViewRootImpl</code>ï¼Œçœ‹çœ‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public ViewParent invalidateChildInParent(int[] location, Rect dirty) &#123;</div><div class="line">    ......</div><div class="line">    //Viewè°ƒè¿invalidateæœ€ç»ˆå±‚å±‚ä¸Šä¼ åˆ°ViewRootImplåæœ€ç»ˆè§¦å‘äº†è¯¥æ–¹æ³•</div><div class="line">    scheduleTraversals();</div><div class="line">    ......</div><div class="line">    return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç›´æ¥è¿”å›Nullï¼Œé€€å‡ºä¸Šé¢çš„å¾ªç¯ï¼Œè€Œ<code>scheduleTraversals</code>è¿™ä¸ªæ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨æœ€åˆæˆ‘ä»¬çœ‹åˆ°çš„<code>performTraversals</code>æ–¹æ³•è¿›è¡Œé‡æ–°ç»˜åˆ¶ã€‚ä½†æ˜¯è‚¯å®šæ˜¯ä¸ä¼šèµ°æœ€åˆçš„æµç¨‹ï¼Œç»è¿‡ä¸€äº›åˆ¤æ–­ä¹‹ååªä¼šå»é‡ç»˜éœ€è¦é‡ç»˜çš„åœ°æ–¹ã€‚è¿˜æ˜¯è´´å¼ å›¾(æ¥è‡ª<a href="">å·¥åŒ è‹¥æ°´</a>)<br><img src="http://img.blog.csdn.net/20150531111928069" alt="">,</p>
<blockquote>
<p>å¸¸è§çš„å¼•èµ·invalidateæ–¹æ³•æ“ä½œçš„åŸå› ä¸»è¦æœ‰ï¼š<br>ç›´æ¥è°ƒç”¨invalidateæ–¹æ³•.è¯·æ±‚é‡æ–°drawï¼Œä½†åªä¼šç»˜åˆ¶è°ƒç”¨è€…æœ¬èº«ã€‚<br>è§¦å‘setSelectionæ–¹æ³•ã€‚è¯·æ±‚é‡æ–°drawï¼Œä½†åªä¼šç»˜åˆ¶è°ƒç”¨è€…æœ¬èº«ã€‚<br>è§¦å‘setVisibilityæ–¹æ³•ã€‚ å½“Viewå¯è§†çŠ¶æ€åœ¨INVISIBLEè½¬æ¢VISIBLEæ—¶ä¼šé—´æ¥è°ƒç”¨invalidateæ–¹æ³•ï¼Œç»§è€Œç»˜åˆ¶è¯¥Viewã€‚å½“Viewçš„å¯è§†çŠ¶æ€åœ¨INVISIBLE\VISIBLE è½¬æ¢ä¸ºGONEçŠ¶æ€æ—¶ä¼šé—´æ¥è°ƒç”¨requestLayoutå’Œinvalidateæ–¹æ³•ï¼ŒåŒæ—¶ç”±äºViewæ ‘å¤§å°å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥ä¼šè¯·æ±‚measureè¿‡ç¨‹ä»¥åŠdrawè¿‡ç¨‹ï¼ŒåŒæ ·åªç»˜åˆ¶éœ€è¦â€œé‡æ–°ç»˜åˆ¶â€çš„è§†å›¾ã€‚<br>è§¦å‘setEnabledæ–¹æ³•ã€‚è¯·æ±‚é‡æ–°drawï¼Œä½†ä¸ä¼šé‡æ–°ç»˜åˆ¶ä»»ä½•ViewåŒ…æ‹¬è¯¥è°ƒç”¨è€…æœ¬èº«ã€‚<br>è§¦å‘requestFocusæ–¹æ³•ã€‚è¯·æ±‚Viewæ ‘çš„drawè¿‡ç¨‹ï¼Œåªç»˜åˆ¶â€œéœ€è¦é‡ç»˜â€çš„Viewã€‚</p>
</blockquote>
<p>æœ€åå†æ¥å»è§£é‡Šä¸€ä¸‹æœ€åˆçš„é‚£ä¸ªviewç»˜åˆ¶å…¥å£çš„é—®é¢˜ï¼Œè¿˜æ˜¯æ¥ä¸Šä¸€ç¯‡ï¼Œåœ¨<code>setContentView</code>æ–¹æ³•é‡Œé¢æœ‰è¿™ä¸ª<code>mContentParent.addView(view, params);</code>è€Œåœ¨<code>addView</code>æ–¹æ³•é‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public void addView(View child, int index, LayoutParams params) &#123;</div><div class="line">        ......</div><div class="line">        invalidate(true);</div><div class="line">        ......</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸‹æ˜ç™½äº†å§ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="http://blog.csdn.net/yanbober/article/details/46128379" target="_blank" rel="external"> Androidåº”ç”¨å±‚Viewç»˜åˆ¶æµç¨‹ä¸æºç åˆ†æ</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/07/09/èŠèŠä»setContentViewåˆ°ç•Œé¢çš„æ˜¾ç¤º/" class="prev">PREV</a><a href="/2016/07/09/Android Binder æµ…æ/" class="next">NEXT</a></div><div data-thread-key="2016/07/09/Viewçš„ç»˜åˆ¶è¿‡ç¨‹/" data-title="Viewçš„ç»˜åˆ¶è¿‡ç¨‹" data-url="http://yoursite.com/2016/07/09/Viewçš„ç»˜åˆ¶è¿‡ç¨‹/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"70kg"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>Â© 2015 - 2017 <a href="http://yoursite.com">70kg</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-81769413-1",'auto');ga('send','pageview');</script></body></html>